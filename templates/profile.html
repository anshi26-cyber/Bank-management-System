{% extends "base.html" %}
{% block content %}

<section class="dashboard">

<div class="container">

<!-- ================= HEADER ================= -->
<div class="profile-header">

    <div class="user-info">
        <div class="avatar">
            {{ user.username|slice:":1"|upper }}
        </div>

        <div>
            <h2>{{ user.get_full_name|default:user.username }}</h2>
            <p>Member since {{ user.date_joined|date:"F Y" }}</p>
        </div>
    </div>

    <div class="actions">
        <a href="{% url 'create_account' %}" class="btn primary">+ Create Account</a>
        <a href="{% url 'transactions' %}" class="btn outline">Transactions</a>
        <a href="{% url 'logout' %}" class="btn danger">Logout</a>
    </div>

</div>


<!-- ================= STATS ================= -->
<div class="stats">

    <div class="stat-card">
        <h4>Total Accounts</h4>
        <p>{{ accounts|length }}</p>
    </div>

    <div class="stat-card">
        <h4>Total Balance</h4>
        <p>
        ₹
        {% for acc in accounts %}
            {{ acc.balance }}
        {% empty %}
            0
        {% endfor %}
        </p>
    </div>

    <div class="stat-card">
        <h4>User</h4>
        <p>{{ user.username }}</p>
    </div>

</div>


<!-- ================= MAIN GRID ================= -->
<div class="grid">

<!-- ACCOUNTS -->
<div class="card">

<h3>Your Accounts</h3>

{% if accounts %}
    {% for acc in accounts %}
    <div class="account-box">

        <div>
            <strong>{{ acc.account_number }}</strong>
            <p>Owner: {{ acc.user.username }}</p>
        </div>

        <div class="balance">
            ₹ {{ acc.balance|floatformat:2 }}
        </div>

    </div>
    {% endfor %}
{% else %}
<p class="empty">No accounts created yet.</p>
{% endif %}

</div>



<!-- RECENT TRANSACTIONS -->
<div class="card">

<h3>Recent Transactions</h3>

{% if recent_transactions %}
<table>

<tr>
<th>Date</th>
<th>Type</th>
<th>Amount</th>
</tr>

{% for t in recent_transactions %}
<tr>
<td>{{ t.timestamp|date:"d M Y" }}</td>
<td>{{ t.get_txn_type_display }}</td>
<td>₹ {{ t.amount }}</td>
</tr>
{% endfor %}

</table>

<a href="{% url 'transactions' %}" class="view-more">
View Full History →
</a>

{% else %}
<p class="empty">No transactions yet.</p>
{% endif %}

</div>

</div>

</div>
</section>
{% endblock %}
