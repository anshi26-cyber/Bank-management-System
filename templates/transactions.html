{% extends "base.html" %}
{% block content %}

<section class="profile-section">
  <div class="profile-wrap">

    <header class="profile-header tx-header">
      <div>
        <h1 class="identity-name">Transaction History</h1>
        <p class="identity-sub">All transactions (newest first)</p>
      </div>

      <div class="tx-home-btn">
        <a class="btn-outline" href="{% url 'home' %}">Back to Home</a>
      </div>
    </header>

    <!-- FILTER PANEL -->
    <div class="panel filter-panel">

      <form method="get" class="filter-form">

        <div class="filter-field">
          <label class="form-label">Search</label>
          <input name="q" value="{{ q }}"
                 placeholder="account # or description"
                 class="form-input">
        </div>

        <div class="filter-field">
          <label class="form-label">From</label>
          <input name="from_date" type="date"
                 value="{{ from_date }}"
                 class="form-input">
        </div>

        <div class="filter-field">
          <label class="form-label">To</label>
          <input name="to_date" type="date"
                 value="{{ to_date }}"
                 class="form-input">
        </div>

        <div class="filter-actions">
          <button type="submit" class="form-btn">Apply</button>
          <a href="{% url 'transactions' %}" class="btn-outline">Reset</a>
        </div>

      </form>
    </div>

    <!-- TABLE -->
    <div class="panel">

      {% if transactions %}
      <table class="tx-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Account</th>
            <th>Type</th>
            <th class="right">Amount</th>
            <th>Description</th>
          </tr>
        </thead>

        <tbody>
        {% for t in transactions %}
          <tr>
            <td class="muted">
              {{ t.timestamp|date:"Y-m-d H:i" }}
            </td>

            <td class="mono">
              {{ t.account.account_number }}
              <div class="tx-user">
                {{ t.account.user.username }}
              </div>
            </td>

            <td>{{ t.get_txn_type_display }}</td>

            <td class="right">
              ₹ {{ t.amount }}
            </td>

            <td>{{ t.description|default:"—" }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <!-- PAGINATION -->
      <div class="pagination-box">

        <div class="page-info">
          Showing {{ transactions.start_index }}
          -
          {{ transactions.end_index }}
          of {{ transactions.paginator.count }}
        </div>

        <div class="page-buttons">

        {% if transactions.has_previous %}
          <a class="btn-outline"
             href="?page={{ transactions.previous_page_number }}">
             Prev
          </a>
        {% else %}
          <button class="btn-outline" disabled>Prev</button>
        {% endif %}

        {% if transactions.has_next %}
          <a class="btn-outline"
             href="?page={{ transactions.next_page_number }}">
             Next
          </a>
        {% else %}
          <button class="btn-outline" disabled>Next</button>
        {% endif %}

        </div>
      </div>

      {% else %}
        <div class="empty">No transactions found.</div>
      {% endif %}

    </div>

  </div>
</section>

{% endblock %}